<!DOCTYPE html>

<head>
    <script type="text/javascript">
        window.languagePluginUrl = 'https://pyodide-cdn2.iodide.io/v0.15.0/full/';
    </script>
    <script src="https://pyodide-cdn2.iodide.io/v0.15.0/full/pyodide.js"></script>
</head>


<body>
    Output:
    </div>
    <textarea id='output' style='width: 100%;' rows='10' disabled></textarea>
    <textarea id='code' rows='3'>
print("yah yeet")
    </textarea>
    <button id='run' onclick='evaluatePython()'>Run</button>
<p><strong>Execution may take some time.</strong></p>

<button onclick='pyodide.globals.fetch()'>Fetch</button>


<script type="text/javascript">
        const output = document.getElementById("output")
        const code = document.getElementById("code")

        function addToOutput(s) {
            output.value += `>>>${code.value}\n${s}\n`
            output.scrollTop = output.scrollHeight
            code.value=''
        }

        output.value = 'Initializing...\n'
        languagePluginLoader.then(() => { output.value += 'Ready!\n' })

        function evaluatePython() {
            pyodide.runPythonAsync(code.value)
                .then(output => addToOutput(output))
                .catch((err) => { addToOutput(err) })
        }
</script>

<script>
    let python_code = `
import js
from js import window

def fetch():
  window.fetch('http://services.buildandshoot.com/serverlist.json').then(lambda resp: resp.json()).then(lambda jsoh: show_result(jsoh))
  
def show_result(data):
  output = js.document.getElementById("output")
  data1 = js.JSON.stringify(data)
  data2 = js.JSON.parse(data1)
  
  js.output.value = data2

`

// init environment
languagePluginLoader
// then run Python code
  .then(() => pyodide.runPythonAsync(python_code));
</script>


</body></html>
